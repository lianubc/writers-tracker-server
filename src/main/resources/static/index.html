<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Writer's Tracker</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
        .hidden { display: none; }
        .error { color: red; }
        .success { color: green; }
        input { display: block; margin-bottom: 10px; width: 100%; padding: 8px; box-sizing: border-box; }
        button { padding: 10px 20px; cursor: pointer; background-color: #007bff; color: white; border: none; }
        button.secondary { background-color: #6c757d; }
        .book-card { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .toggle-link { color: blue; cursor: pointer; text-decoration: underline; font-size: 0.9em; }
    </style>
</head>
<body>

<div id="login-section">
    <h1>Login</h1>
    <p class="error" id="login-error"></p>
    <p class="success" id="login-success"></p>

    <input type="text" id="login-username" placeholder="Username" value="LisaWriter">
    <input type="password" id="login-password" placeholder="Password" value="securepassword123">
    <button onclick="login()">Login</button>

    <p>Don't have an account? <span class="toggle-link" onclick="showRegister()">Register here</span></p>
</div>

<div id="register-section" class="hidden">
    <h1>Register</h1>
    <p class="error" id="register-error"></p>

    <input type="text" id="reg-username" placeholder="Username">
    <input type="email" id="reg-email" placeholder="Email">
    <input type="text" id="reg-penName" placeholder="Pen Name (Optional)">
    <input type="password" id="reg-password" placeholder="Password">

    <button onclick="register()">Create Account</button>
    <button class="secondary" onclick="showLogin()">Back to Login</button>
</div>

<div id="dashboard-section" class="hidden">
    <h1>My Books</h1>
    <button onclick="logout()" style="background-color: #dc3545;">Logout</button>
    <div id="books-list" style="margin-top: 20px;"></div>
</div>

<script>
    const API_URL = "http://localhost:8080";

    // --- NAVIGATION FUNCTIONS ---
    function showRegister() {
        document.getElementById("login-section").classList.add("hidden");
        document.getElementById("register-section").classList.remove("hidden");
    }
    function showLogin() {
        document.getElementById("register-section").classList.add("hidden");
        document.getElementById("login-section").classList.remove("hidden");
    }

    // --- API FUNCTIONS ---
    async function register() {
        const username = document.getElementById("reg-username").value;
        const email = document.getElementById("reg-email").value;
        const password = document.getElementById("reg-password").value;
        const penName = document.getElementById("reg-penName").value;

        try {
            const response = await fetch(`${API_URL}/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, email, password, penName })
            });

            if (response.ok) {
                showLogin();
                document.getElementById("login-success").innerText = "Registration successful! Please login.";
                document.getElementById("login-error").innerText = "";
            } else {
                const text = await response.text();
                document.getElementById("register-error").innerText = "Error: " + text;
            }
        } catch (error) {
            document.getElementById("register-error").innerText = "Server connection failed.";
        }
    }

    async function login() {
        const username = document.getElementById("login-username").value;
        const password = document.getElementById("login-password").value;

        try {
            const response = await fetch(`${API_URL}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            if (response.ok) {
                document.getElementById("login-section").classList.add("hidden");
                document.getElementById("dashboard-section").classList.remove("hidden");
                loadBooks();
            } else {
                document.getElementById("login-error").innerText = "Invalid credentials!";
            }
        } catch (error) {
            document.getElementById("login-error").innerText = "Server error!";
        }
    }

    async function loadBooks() {
        const response = await fetch(`${API_URL}/books`);
        if (response.status === 403) {
            alert("Session expired.");
            logout();
            return;
        }
        const books = await response.json();
        const list = document.getElementById("books-list");
        list.innerHTML = "";

        if (books.length === 0) {
            list.innerHTML = "<p>No books found. (You can add a Create Book feature next!)</p>";
        } else {
            books.forEach(book => {
                const div = document.createElement("div");
                div.className = "book-card";
                div.innerHTML = `<h3>${book.title}</h3><p>Genre: ${book.genre}</p>`;
                list.appendChild(div);
            });
        }
    }

    async function logout() {
        await fetch(`${API_URL}/logout`, { method: 'POST' });
        window.location.reload();
    }
</script>
</body>
</html>